<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sakura's Bookstore</title>
    <link rel="icon" href="../img/Logo1.svg">
    <!-- Enlaces diseño-->
    <script src="../script/loadContenLogin.js" defer></script>
    <script src="../node_modules/bootstrap/dist/js/bootstrap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>
    <script src="../script/adminCRUD.js"></script>
    <script src="../script/productos.js"></script>
    <script src="../script/usuarios.js"></script>
    <script src="../script/paises.js"></script>
    <link rel="stylesheet" href="../css/style.css">
  </head>
<body>
    
    <!-- Header -->
    <div id="header-container">
        <style>
            .itemBuscador{
                display: none;
            }
        </style>
    </div>
    <!-- ACORDIÓN -->
    <div class="m-4 fuente3">

        <div class="accordion" id="accordionExample">

            <!-- agregar productos -->
            <div class="accordion-item">
                <h2 class="accordion-header">
                <button class="accordion-button fuente3 fs-5" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                    <svg class="bi me-2" width="30" height="24" fill="CurrentColor"><use xlink:href="../style/bootstrap-icons-1.11.1/bootstrap-icons.svg#journal-arrow-up"/></svg>Productos
                </button>
                </h2>
                <div id="collapseOne" class="accordion-collapse collapse show" data-bs-parent="#accordionExample">
                <div class="accordion-body me-5 ms-5">
                    <h1  class="p-2 m-2 text-center fuente1">Agregar productos al dispensador</h1>
                    <form id="bookForm" enctype="form-data">

                        <div class="row">

                            <div class="col-6 fuente3">
                                <div class="mb-3">
                                    <label for="code" class="form-label">ISBN:</label>
                                    <input type="text" id="code" name="code" class="form-control" required>
                                </div>
                            </div>

                            <div class="col-6 fuente3">
                                <div class="mb-3">
                                    <label for="name" class="form-label">Nombre:</label>
                                    <input type="text" id="name" name="name" class="form-control" required>
                                </div>
                            </div>

                        </div>

                        <div class="mb-3 fuente3">
                            <label for="description" class="form-label">Descripción:</label>
                            <textarea id="description" name="description" rows="4" cols="50" class="form-control" required></textarea>
                        </div>

                        <div class="row">

                            <div class="col-6 fuente3">
                                <div class="mb-3">
                                    <label for="editorial" class="form-label">Editorial:</label>
                                    <input type="text" id="editorial" name="editorial" class="form-control" required>
                                </div>
                                <div class="mb-3">
                                    <label for="author" class="form-label">Autor:</label>
                                    <input type="text" id="author" name="author" class="form-control" required>
                                </div>
                                <div class="mb-3">
                                    <label for="stock" class="form-label">Stock:</label>
                                    <input type="number" id="stock" name="stock" class="form-control" required>
                                </div>
                                <div class="mb-3">
                                    <label for="category" class="form-label">Generos:</label>
                                    <input type="text" id="category" name="category" class="form-control" required>
                                    <div id="emailHelp" class="form-text">Separados por comas.</div>
                                </div>
                            </div>

                            <div class="col-6 fuente3">
                                <div class="mb-3">
                                    <label for="year" class="form-label">Año:</label>
                                    <input type="number" id="year" name="year" class="form-control" required>
                                </div>
                                <div class="mb-3">
                                    <label for="price" class="form-label">Precio:</label>
                                    <input type="number" step="0.01" id="price" name="price" class="form-control" required>
                                </div>
                                <div class="mb-3">
                                    <label for="sellPrice" class="form-label">Precio de venta:</label>
                                    <input type="number" step="0.01" id="sellPrice" name="sellPrice" class="form-control" required>
                                </div>
                                <div class="mb-3">
                                    <label for="image" class="form-label">Imagen:</label><br>
                                    <input  type="file"  accept="image/png,image/jpeg,image/jpg" id="file" class="form-control" name="file">
                                </div>
                            </div>

                        </div>

                    
                        <button type="submit" class="btn btn-secondary" onclick="addProduct()">Enviar</button>
                        </form>
                </div>
                </div>
            </div>

            <!-- agregar usuarios -->
            <div class="accordion-item">
                <h2 class="accordion-header">
                    <button class="accordion-button collapsed fuente3 fs-5" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
                    <svg class="bi me-2" width="30" height="24" fill="CurrentColor"><use xlink:href="../style/bootstrap-icons-1.11.1/bootstrap-icons.svg#people-fill"/></svg>Usuarios
                    </button>
                </h2>
                <div id="collapseTwo" class="accordion-collapse collapse" data-bs-parent="#accordionExample">
                    <div class="accordion-body">
                        <h1 class="p-2 m-2 text-center fuente1">Crear cuentas de usuarios</h1>
                        <form class="row" enctype="form-data">

                            <div class="col-6">
                                <div class="mb-3">
                                    <label for="validationDefault01" class="form-label">Nombre completo</label>
                                    <input type="text" class="form-control" id="validationDefault01" nombre="" required>
                                </div>
                                <div class="mb-3">
                                    <label for="validationDefault02" class="form-label">Edad</label>
                                    <input type="number" class="form-control" id="validationDefault02" min="1" pattern="^[0-9]+" edad="" required>
                                </div>
                                <div class="mb-3">
                                    <label for="validationDefaultUsername" class="form-label">Correo electronico</label>
                                    <input type="email" class="form-control" id="validationDefaultUsername" aria-describedby="inputGroupPrepend2" correo="" required>
                                </div>
                                <div class="mb-3">
                                    <label for="validationDefaultUsername" class="form-label">Nombre de usuario</label>
                                    <div class="input-group">
                                        <input type="text" class="form-control" id="validationDefaultUsername" aria-describedby="inputGroupPrepend2" usuario="" required>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label for="exampleFormControlTextarea1" class="form-label">Direccion principal</label>
                                    <textarea class="form-control" id="exampleFormControlTextarea1" rows="3" d-principal required></textarea>
                                </div>
                            </div>
                    
                            <div class="col-6">
                                <div class="mb-3">
                                    <label for="genero" class="form-label" >Género:</label>
                                    <select class="form-select" required aria-label="select example" id="genero" genero="">
                                    <option selected disabled value="">Seleccione su género</option>
                                    <option value="Masculino">Masculino</option>
                                    <option value="Femenino">Femenino</option>
                                    <option value="Otro">39 tipos de gay</option>
                                    </select>
                                </div>
                                <div class="mb-3">
                                    <label for="foto" class="form-label">Foto de perfil:</label>
                                    <input  accept="image/png,image/jpeg,image/jpg" id="foto" type="file" class="form-control" aria-label="file example" foto="" required>
                                </div>
                                <div class="mb-3">
                                    <label for="validationDefaultUsername" class="form-label">Contraseña</label>
                                    <div class="input-group">
                                        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.2/css/all.css" integrity="sha384-oS3vJWv+0UjzBfQzYUhtDYW+Pj2yciDJxpsK1OYPAYjqT085Qq/1cq5FLXAZQ7Ay" crossorigin="anonymous">
                                        <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
                                        <script src="https://unpkg.com/bootstrap-show-password@1.2.1/dist/bootstrap-show-password.min.js"></script>
                                        <input data-toggle="password" class="form-control" type="password" contraseña="" required>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label for="validationDefault04" class="form-label mt-xl-0 mt mt-lg-0">Pais</label>
                                    <select class="form-select" id="paises" pais="" required>
                                        <option selected disabled value="">Elija su pais</option>
                                    </select>
                                </div>
                                <div class="mb-3">
                                    <label for="exampleFormControlTextarea1" class="form-label">Direcciones de envio</label>
                                    <textarea class="form-control" id="exampleFormControlTextarea1" rows="3" d-envios required></textarea>
                                    <div id="emailHelp" class="form-text">Separe con una ',' cada direccion. Ej: Direccion 1, Direccion 2</div>
                                </div>
                            </div>
                            

                            <div class="text-center text-lg-start mt-2">
                                <a type="" class="btn btn-secondary" style="padding-left: 2.5rem; padding-right: 2.5rem;" registro>Registrar</a>
                            </div>
                        </form>
                    
                    </div>
                </div>
                </div>


        </div>
    </div>

    <!-- TABLAS -->
    <div class="row m-4">

        <div class="col-7">

            <h1 class="fuente3">Listado de Productos</h1>
            
            <div class="mb-3">
                <label for="searchInput" class="form-label fuente3">Buscar:</label>
                <input type="text" class="form-control" id="searchInput1">
            </div>
            
            <table class="table table-striped fuente3 align-middle">
                <thead>
                    <tr class="">
                        <th scope="col">Nombre</th>
                        <th scope="col">Editorial</th>
                        <th scope="col">Autor</th>
                        <th scope="col">Acciones</th>
                    </tr>
                </thead>

                <tbody id="bodyProductos">
                    <!-- Aqui se insertan todos los productos -->
                </tbody>
            </table>

        </div>

        <div class="col-5">

            <h1 class="fuente3">Listado de Usuarios</h1>

            <div class="mb-3">
                <label for="searchInput" class="form-label fuente3">Buscar:</label>
                <input type="text" class="form-control" id="searchInput2">
            </div>

            <table class="table table-striped fuente3">
                <thead>
                  <tr>
                    <th scope="col">Nombre</th>
                    <th scope="col">Usuario</th>
                    <th scope="col">Pais</th>
                    <th scope="col">Acciones</th>
                  </tr>
                </thead>
    
                <tbody id="bodyUsuarios">
                  <!-- Las filas de la tabla se agregarán dinámicamente aquí -->
                </tbody>
            </table>

        </div>

    </div>



    <!-- Footer -->
    <div id="footer-container"></div>

    <script>


document.addEventListener("DOMContentLoaded", function() {
    // Obtener el elemento select
    var selectPaises = document.getElementById("paises");

    // Obtener la lista de países desde el enlace
    fetch('http://127.0.0.1:8000/api/paises')
      .then(response => response.json())
      .then(data => {
        // Iterar sobre el arreglo de países y agregar opciones al select
        data.forEach(function(pais) {
          var opcion = document.createElement("option");
          opcion.value = pais.nombre;
          opcion.text = pais.nombre;
          selectPaises.add(opcion);
        });
      })
      .catch(error => console.error('Error al obtener la lista de países:', error));
  });

const submitButton = document.querySelector('[registro]');
submitButton.addEventListener('click', async function(e){
   e.preventDefault();

    const nombre = document.querySelector('[nombre]');
    const edad = document.querySelector('[edad]');
    const genero = document.querySelector('[genero]');
    const foto = document.querySelector('[foto]');
    const correo = document.querySelector('[correo]');
    const contrasena = document.querySelector('[contraseña]');
    const usuario = document.querySelector('[usuario]');
    const paises = document.querySelector('[pais]');
    const direccionPrincipal = document.querySelector('[d-principal]');
    const direccionesEnvio = document.querySelector('[d-envios]');

    console.log(genero);


    if (foto.files.length > 0) {
        const file = foto.files[0];
        const reader = new FileReader();reader.onload = function (e) {
       
        const formData = new FormData();
        formData.append('username', usuario.value);
        formData.append('email', correo.value);
        formData.append('password', contrasena.value);
        formData.append('name', nombre.value);
        formData.append('age', edad.value);
        formData.append('gender', genero.value);
        console.log(genero.value);
        formData.append('file', file);
        formData.append('country', paises.value);
        formData.append('address', direccionPrincipal.value);
        formData.append('send_address', direccionesEnvio.value);
        formData.append('refer_code', '64ZTR2FNPQ'); 

            fetch('http://127.0.0.1:8000/api/Usuario', {
                method: 'POST',
                headers: {
                    
                },
                body: formData,
            }).then(async function(response) {
                if (!response.ok) {
                    return false;
                }
                
                return response.json();
            }).then(function(data) {
                console.log("en teoria se mandaron los datos");
                if(data.res == true){
                    Swal.fire({
                        title: 'Registrado',
                        text: 'Has sido registrado con exito.',
                        icon: 'success',
                        confirmButtonText: 'Aceptar',
                        customClass: {
                            content: 'text-center'
                        }
                    }).then((result) => {
                        if (result.isConfirmed) {
                            // Redirige a la página deseada
          /*                   window.location.href = 'http://127.0.0.1:5501/html/indexSession.html'; */
                        }
                    });
                }

            }).catch(function(err) {
                console.error(err);
            });
        };

        reader.readAsDataURL(file);
    }



});


document.getElementById('cerrarSesionButton').addEventListener('click', function(event) {
    console.log('Evento de clic registrado');  // Agrega esta línea

    event.preventDefault();

    console.log('Clic en Cerrar Sesión');

    localStorage.removeItem('userInfo');
    localStorage.removeItem('photoUser');
    localStorage.removeItem('token');
    console.log('Datos eliminados del localStorage');

    window.location.href = '../html/index.html';
});


    </script>
    
  </body>
</html>
